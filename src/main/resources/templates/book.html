<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- CSS personalizzato -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
</head>
<body>
<!-- Include la navbar -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Dettagli del libro -->
<div id="app" class="book-details">
    <h1 th:text="${book.title}">Titolo del libro</h1>

    <p><strong>Anno di pubblicazione:</strong> <span th:text="${book.publicationYear}">2025</span></p>

    <!-- Copertina -->
    <div class="book-cover">
        <img th:src="@{'/book/' + ${book.id} + '/cover'}" th:alt="${book.title}" onerror="this.onerror=null;this.src='/images/coverPlaceholder.png';">
    </div>

    <!-- Altre immagini -->
    <div class="book-images">
        <h3>Immagini del libro</h3>
        <div th:each="img : ${book.images}">
            <img th:src="@{'/book/' + ${book.id} + '/images/' + ${img.id}}" alt="Immagine del libro">
        </div>
    </div>

    <!-- Autori -->
    <div class="book-authors">
        <h3>Autori</h3>
        <ul>
            <li th:each="author : ${book.authors}" th:text="${author.name}">Autore</li>
        </ul>
    </div>

    <!-- Recensioni -->
    <div class="book-reviews">
        <h3>Recensioni</h3>

        <!-- Bottone per aggiungere una recensione -->
        <div class="text-center mt-4"
             id="addReviewButton"
             th:if="${userDetails != null}">
            <div th:if="${error}" class="alert" role="alert"
                 th:text="${error} ?: 'Errore sconosciuto.'"></div>
            <a th:href="@{'/book/' + ${book.id} + '/addReview'}"
               class="btn btn-primary">
                Aggiungi Recensione
            </a>
        </div>

        <div th:each="review : ${book.reviews}">
            <div class="container mt-4">
                <strong th:text="${review.author.username}">Nome recensore</strong>:
                <h4 th:text="${review.title}">Titolo</h4>
                <span th:text="${review.text}">Testo</span>
                <span th:text="${review.rating}">Voto</span>
            </div>
            <!-- Bottone visibile solo se l'utente loggato Ã¨ l'autore -->
            <div th:if="${userDetails != null and userDetails.username == review.author.username}">
                <a th:href="@{'/book/' + ${book.id} + '/updateReview/' + ${review.id}}" class="btn btn-sm btn-warning">
                    Modifica
                </a>
            </div>
        </div>
    </div>
</div>

</body>
</html>
